# Repository Guidelines

## Структура проекта и модулей

Основная логика реализована на TypeScript в директории `src/`. В точке входа `src/main.ts`
подготавливается транспорт для почты и запускается сервер Express. В файле `src/application.ts`
происходит инициализация компонентов приложения – регистрируются middleware и обработчики запросов.

Логика обработки HTTP-запросов сосредоточена в `src/handlers/`, переиспользуемые middleware – в
`src/middlewares/`, вспомогательные функции – в `src/utils/`. Конфигурация приложения объявлена в
`src/config.ts`.

TypeScript компилирует код в `dist/`, файлы в этой директории не редактируются вручную. Настройки
линтера находятся в `eslint.config.mjs`, настройки компилятора TypeScript – в `tsconfig.json`.

## Сборка, тесты и локальный запуск

Для установки зависимостей необходимо выполнить `npm install`.

Команда `npm run build` компилирует TypeScript и сохраняет результат компиляции в директорию
`dist/`. Для запуска production-сборки следует использовать `npm run start` – эта команда выполняет
`dist/main.js` после предварительной сборки проекта.

Команда `npm run lint` проверяет соответствие кода стандартам стиля, `npm run lint-fix`
автоматически исправляет обнаруженные нарушения, которые поддаются автоматическому исправлению.

Перед публикацией изменений необходимо выполнить `npm run format` для приведения кода к требованиям
Prettier.

## Стиль кода и соглашения об именовании

Файлы именуются в kebab-case (`mail-options.ts`). Проект использует настройки ESLint из
`eslint.config.mjs`. Форматирование выполняет Prettier: отступ в 2 пробела, двойные кавычки,
хвостовые запятые где это возможно. Переменные и функции именуются в camelCase, типы и интерфейсы –
в PascalCase. Имя файла соответствует основной экспортируемой сущности (`createOrderCallHandler` →
`calls.ts`). Обработчики фокусируются на HTTP и валидации, вспомогательные функции пишутся чистыми и
переиспользуемыми.

## Тестирование

После любых изменений в коде нужно запускать следующие команды:

- `npm run format` для форматирования кода
- `npm run build-check` для проверки типов TypeScript
- `npm run lint-fix` для поиска и исправления ошибок, отклонений в стиле кода

Проект использует Vitest как тестовый фреймворк. Модульные (unit) тесты располагаются рядом с
тестируемым кодом в директории `src/` – для модуля `src/handlers/calls.ts` создаётся
`src/handlers/calls.test.ts`. Интеграционные тесты находятся в директории `tests/`.

Для запуска всех тестов используется команда `npm run test`. Команда `npm run test-watch` запускает
тесты в режиме отслеживания изменений, `npm run test-coverage` собирает информацию о покрытии кода.

Unit-тесты проверяют изолированные функции и модули с использованием моков для внешних зависимостей
(почта, файловая система, внешние API). Вспомогательные функции (`src/utils/`) и middleware
тестируются с проверкой граничных случаев и обработки ошибок.

Интеграционные тесты в `tests/` проверяют взаимодействие компонентов через HTTP-запросы с
использованием `supertest`. Они покрывают критичные сценарии: обработку запросов, валидацию данных,
отправку писем.

Тесты должны быть независимыми и не зависеть от порядка выполнения. Перед созданием Pull Request
необходимо убедиться, что все тесты проходят успешно и новый код покрыт тестами.

## Коммиты и pull request'ы

Сообщения коммитов пишутся на русском языке в прошедшем времени, например `Починила валидацию`.
Коммиты делаются сфокусированными и описывают одно изменение за раз.

В PR включаются: краткое описание задачи и сделанных изменений в коде, изменения конфигурации
(переменные окружения, порты).

## Безопасность и конфигурация

Секреты (`API_TOKEN`, `MAIL_PASSWORD`) передаются через переменные окружения. Файл `.env` не
добавляется в git. Логирование входящих токенов и загруженных файлов не рекомендуется.
